
# conjure-typescript ![Bintray](https://img.shields.io/bintray/v/palantir/releases/conjure-typescript.svg) [![License](https://img.shields.io/badge/License-Apache%202.0-lightgrey.svg)](https://opensource.org/licenses/Apache-2.0)


_CLI to generate TypeScript Interfaces and clients from [Conjure API definitions](https://github.com/palantir/conjure)._

## Overview

The generated clients provide a simple Promise based interface for executing strongly typed remote procedure calls from
the browser or server.

## Usage
The recommended way to use conjure-typescript is via a build tool like [gradle-conjure](https://github.com/palantir/gradle-conjure). 
However, if you don't want to use gradle-conjure, there is also an executable which conforms to [RFC 002](https://github.com/palantir/conjure/blob/develop/rfc/002-contract-for-conjure-generators.md),  published on [bintray](https://bintray.com/palantir/releases/conjure-typescript).

```
conjure-typescript generate <input> <output> [..Options]

Generate TypeScript bindings for a Conjure API

Positionals:
  input   The location of the apis IR
  output  The output location of the generated code

Options:
  --version                Show version number                                                                           [boolean]
  --help                   Show help                                                                                     [boolean]
  --packageVersion         The version of the generated package                                                           [string]
  --packageName            The name of the generated package                                                              [string]
  --nodeCompatibleModules  Generate node compatible javascript                                          [boolean] [default: false]
  --rawSource              Generate raw source without any package metadata                             [boolean] [default: false]
  --productDependencies    Path to a file containing a list of product dependencies                                       [string]
```

## SemVer releases

This project is versioned according to [SemVer](https://semver.org/). We consider the generated code to be part of 
the 'public API' of conjure-typescript, i.e. TypeScript generated by old conjure-typescript and new 
conjure-typescript (within a major version) should be compatible, so your consumers should be able to upgrade without compilation problems.

We also consider the command line interface and feature flags to be public API.


## Example generated objects

- **Conjure object: [ManyFieldExample](./src/commands/generate/__tests__/resources/types/manyFieldExample.ts)**

  Objects can easily be instantiated:

    ```typescript
    const example: ManyFieldExample = {
      string: "foo",
      integer: 123,
      optionalItem: "bar",
      items: []
  }
    ```

- **Conjure union: [UnionTypeExample](./src/commands/generate/__tests__/resources/types/unionTypeExample.ts)**

    Union types can be one of a few variants. To interact with a union value, users should use the `.accept` method and define a Visitor that handles each of the possible variants, including the possibility of an unknown variant.

    ```typescript
    const output = IUnionTypeExample.visit(obj, {

        string: (value: string) => {
            // your logic here!
        },

        set: (value: string[]) => {},

        // ...

        unknown: (unknownType: IUnionTypeExample) => {}

    });
    ```

    Visitors may seem clunky in TypeScript, but they have the upside of compile-time assurance that you've handled all the possible variants.  If you upgrade an API dependency and the API author added a new variant, the TypeScript compiler will force you to explicitly deal with this new variant.  We intentionally avoid `switch` statements.

- **Conjure enum: [EnumExample](./src/commands/generate/__tests__/resources/types/enumExample.ts)**
    conjure-typescript leverages TypeScript great out of the box support for [string Enums](https://www.typescriptlang.org/docs/handbook/enums.html#string-enums).

  ```typescript
  const one = EnumExample.ONE;
  console.log(one); // "ONE"
  ```

- **Conjure alias**

  TypeScript uses structural (duck-typing) so aliases are currently elided.

## Example Client interfaces

Example service interface: [EteService](./conjure-typescript-core/src/integrationInput/typescript/com/palantir/product/EteService.typescript)

```typescript
export interface IEteService {
    string(): Promise<string>;
}

export class EteService implements IEteService {
    public string(): Promise<string> {
        this.bridge.callEndpoint<string>({
            TODO(forozco): populate when generated
            //...
        })
        // ..
    }
}
```

### Constructing clients

Use [conjure-typescript-client](https://github.com/palantir/conjure-typescript-client) which configures the browser's
[Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) with sensible defaults:

```typescript
import { DefaultHttpApiBridge } from "conjure-client";
const recipes = new RecipeBookService(new DefaultHttpApiBridge({
    baseUrl: "https://some.base.url.com",
    userAgent: {
        productName: "yourProductName",
        productVersion: "1.0.0"
    }
}));

const results: Recipe[] = await recipes.getRecipes();
```

## Contributing

For instructions on how to set up your local development environment, check out the [Contributing document](./CONTRIBUTING.md).
